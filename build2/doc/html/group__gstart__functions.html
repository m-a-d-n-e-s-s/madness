<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: MADNESS functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MADNESS
   &#160;<span id="projectnumber">0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MADNESS functions<div class="ingroups"><a class="el" href="group__getting__started.html">Getting started with MADNESS</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for MADNESS functions:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__gstart__functions.png" border="0" alt="" usemap="#group____gstart____functions"/>
<map name="group____gstart____functions" id="group____gstart____functions">
<area shape="rect" id="node1" href="group__getting__started.html" title="Getting started with\l MADNESS" alt="" coords="6,5,138,45"/>
</map>
</td></tr></table></center>
</div>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd>Verify that the code snippets here aren't stale. They're imported from a 2010 document.</dd></dl>
<dl class="section user"><dt>Defaults for functions</dt><dd></dd></dl>
<p>Default values for all function and operator attributes are stored in the <code>FunctionDefaults</code> class. This is actually a template so that different values can be set for functions with different numbers of dimensions. We saw earlier that </p><div class="fragment"><div class="line">FunctionDefaults&lt;1&gt;::set_cubic_cell(0,10);</div></div><!-- fragment --><p> sets the user's simulation cell as <img class="formulaInl" alt="$[0,10]$" src="form_10.png"/>. Presently, all functions of a given dimension must share the same cell. Other common attributes are</p><ul>
<li><code>k</code> &ndash; the wavelet order. <a class="el" href="classA.html">A</a> practical rule of thumb is if the default truncation threshold is <img class="formulaInl" alt="$10^{-n}$" src="form_11.png"/>, then the order should be chosen as <img class="formulaInl" alt="$k=n+2$" src="form_12.png"/>. The default is 6.</li>
<li><code>thresh</code> &ndash; the truncation threshold. The default is <code>1e-4</code>.</li>
<li><code>bc</code> &ndash; the boundary conditions. See below for more details. The default is free.</li>
</ul>
<dl class="section user"><dt>Boundary conditions</dt><dd></dd></dl>
<p>In MADNESS, boundary conditions are associated with operators, not functions, and the boundary conditions are imposed on the surface enclosing the entire simulation volume. That is, they are exterior boundary conditions. For derivative operators the following conditions are understood, and can be imposed separately on each surface</p><ul>
<li><code>BC_ZERO</code> &ndash; Zero Dirichlet</li>
<li><code>BC_PERIODIC</code> &ndash; Periodic (both left and right surfaces must agree on this value)</li>
<li><code>BC_FREE</code> &ndash; Free (default)</li>
<li><code>BC_DIRICHLET</code> &ndash; General Dirichlet (requires provision of one or more functions)</li>
<li><code>BC_ZERONEUMANN</code> &ndash; Zero Neumann</li>
<li><code>BC_NEUMANN</code> &ndash; General Neumann (requires provision of one or more functions)</li>
</ul>
<p>For integral operators only periodic and free-space conditions are understood &ndash; <code>BC_PERIODIC</code> yields periodic and all other conditions yield free-space.</p>
<p class="">Example: to make the default boundary conditions in 3<a class="el" href="structD.html">D</a> </p><div class="fragment"><div class="line">BoundaryConditions&lt;3&gt; bc(<a class="code" href="namespacemadness.html#a00d23554cf7023bc716454aaf858d8a3ae4d41c7c1430913b550260b78ba8edd6">BC_FREE</a>);</div></div><!-- fragment --><p class="">Example: to make boundary conditions in 3<a class="el" href="structD.html">D</a> with zero Dirichlet in <img class="formulaInl" alt="$x$" src="form_5.png"/> and <img class="formulaInl" alt="$y$" src="form_13.png"/> and periodic in <img class="formulaInl" alt="$z$" src="form_14.png"/>, </p><div class="fragment"><div class="line">BoundaryConditions&lt;3&gt; bc(<a class="code" href="namespacemadness.html#a00d23554cf7023bc716454aaf858d8a3aa4035f0f02cd6a5ba8424ea52ab6b45a">BC_ZERO</a>);</div><div class="line"></div><div class="line">bc(2,0) = bc(2,1) = <a class="code" href="namespacemadness.html#a00d23554cf7023bc716454aaf858d8a3ab5d7cdd99f2b4e3109d7b1ac9d78f9f0">BC_PERIODIC</a>;</div></div><!-- fragment --><p class="">Example: to override the default boundary conditions with yours in a variable named <code>bc</code> in 3<a class="el" href="structD.html">D</a> </p><div class="fragment"><div class="line">FunctionDefaults&lt;3&gt;::set_bc(bc);</div></div><!-- fragment --><dl class="section user"><dt>Differentiation, multiplication, inner products</dt><dd></dd></dl>
<p>We now examine operations such as differentiation, multiplication, and inner products. <a class="el" href="classA.html">A</a> relevant simple example is <code>trunk/src/examples/hatom_energy.cc</code>.</p>
<p class=""><em>Differentiation</em></p>
<p class="">Differentiation is performed by applying a differential operator to a function. The operator is constructed with desired the boundary conditions and direction for differentiation (directions are indexed starting from zero, so in 3<a class="el" href="structD.html">D</a> <code>x=0</code>, <code>y=1</code>, and <code>z=2</code>). The operators can be kept for repeated application, or made and discarded after use.</p>
<p class="">For example, to make the derivative operator in 3<a class="el" href="structD.html">D</a> with respect to the first variable using boundary conditions from <code>FunctionDefaults</code>, and to apply it to functions <code>f</code>, <code>g</code> and <code>h</code>: </p><div class="fragment"><div class="line"><a class="code" href="namespacemadness.html#aeedc65e854c21cb166c75137bb226e2b">real_derivative_3d</a> Dx(world, 0); </div><div class="line"><a class="code" href="namespacemadness.html#aabc223d277e0d9dd79d7c61d200d457f">real_function_3d</a> dfdx = Dx(<a class="code" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>); </div><div class="line"><a class="code" href="namespacemadness.html#aabc223d277e0d9dd79d7c61d200d457f">real_function_3d</a> dgdx = Dx(<a class="code" href="testgconv_8cc.html#a9acac0c48cb57a6c2fe531df09859464">g</a>); </div><div class="line"><a class="code" href="namespacemadness.html#aabc223d277e0d9dd79d7c61d200d457f">real_function_3d</a> dhdx = Dx(<a class="code" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a>); </div></div><!-- fragment --><p class=""><em>Multiplication, addition, subtraction of functions</em></p>
<p class="">Most simple mathematical operations can be composed in MADNESS as they are normally written in standard notation. For instance, if <code>f</code>, <code>g</code> and <code>h</code> are functions the expression </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ f(x) = 2g(x) + 3h(x) - 7g(x)h(x) + 99 \]" src="form_15.png"/>
</p>
<p> is transcribed as </p><div class="fragment"><div class="line"><a class="code" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a> = 2*<a class="code" href="testgconv_8cc.html#a9acac0c48cb57a6c2fe531df09859464">g</a> + 3*<a class="code" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a> - 7*<a class="code" href="testgconv_8cc.html#a9acac0c48cb57a6c2fe531df09859464">g</a>*<a class="code" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a> + 99;</div></div><!-- fragment --><p> where <code>*</code> indicates point-wise multiplication of functions.</p>
<dl class="section attention"><dt>Attention</dt><dd>Addition and subtraction of functions are exact operations in the sense that the result can be exactly represented in the MADNESS basis. Multiplication is <em>inexact</em> since the product of two polynomials of order <img class="formulaInl" alt="$k$" src="form_16.png"/> is of order <img class="formulaInl" alt="$2k$" src="form_17.png"/>. The auto-refinement algorithm within MADNESS is still under development &ndash; please refer to the implementation notes for more detail.</dd></dl>
<p><em>Inner products</em></p>
<p class="">The inner product of two functions is defined as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left( f \left| g \right. \right) = \int f(x)^\textrm{*} g(x) dx, \]" src="form_18.png"/>
</p>
<p> where <img class="formulaInl" alt="$\textrm{*}$" src="form_19.png"/> indicates complex conjugation and the integral is taken over the entire simulation volume. The above is computed for two MADNESS functions <code>f</code> and <code>g</code> of the same type using </p><div class="fragment"><div class="line"><a class="code" href="namespacemadness.html#a48fc146ca182b21b57255589fe697bfd">inner</a>(<a class="code" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <a class="code" href="testgconv_8cc.html#a9acac0c48cb57a6c2fe531df09859464">g</a>);</div></div><!-- fragment --><p> If the input functions are real, the result is real; for complex functions the result is complex.</p>
<dl class="section user"><dt>Integral operators</dt><dd></dd></dl>
<p>The Poisson equation </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla^{2} u = -4\pi \rho \]" src="form_20.png"/>
</p>
<p> is ubiquitous in scientific and engineering simulations. For the sake of simplicity, we assume free-space boundary conditions (zero at infinity), such that the Green's function is just <img class="formulaInl" alt="$1/\left| r \right|$" src="form_21.png"/>. If the right-hand side of the Poisson equation is <code>rho</code>, then the Poisson equation can be solved in MADNESS as </p><div class="fragment"><div class="line"><a class="code" href="namespacemadness.html#a22f5c148c98026965b7d26192df2429d">real_convolution_3d</a> <a class="code" href="kain_8cc.html#ad9ea8219fce53cf10491311a9aac2fc0">op</a> = <a class="code" href="namespacemadness.html#a7a90383e6bcee6c6af8be53712f841c9">CoulombOperator</a>(world, 0.001, 1<a class="code" href="test__sig_8cc.html#aed138f72d7301a9034a719a95c4903da">e</a>-6);</div><div class="line"></div><div class="line"><a class="code" href="namespacemadness.html#aabc223d277e0d9dd79d7c61d200d457f">real_function_3d</a> result = <a class="code" href="kain_8cc.html#ad9ea8219fce53cf10491311a9aac2fc0">op</a>(rho);</div></div><!-- fragment --><p class="">This is employed by many codes in the <code>examples</code> directory. The call to <code>CoulombOperator</code> builds a low-separation rank approximation (see the implementation notes) of the Green's function for the Poisson equation. The approximation is accurate to <code>1e-6</code> from a smallest length scale of 0.001 to the entire box size.</p>
<p class="">If you have more complicated boundary conditions which require single or double layer terms please refer the example in <code>trunk/src/examples/interior_dirichlet.cc</code> for more details.</p>
<dl class="section user"><dt>Operations on vectors of functions</dt><dd></dd></dl>
<p>The header file <code>madness/mra/vmra.h</code> defines operations on vectors of functions. These are convenient in eliminating error-prone loops over arrays/vectors of functions, and the vector operations are much more efficient since many operations can occur in parallel. The example code <code>trunk/src/examples/vnucso.cc</code> and the molecular density functional code make extensive use of the vector API (application programming interface) to solve eigenproblems. Let us discuss this in more detail.</p>
<p class="">Given a subspace defined by a vector of <img class="formulaInl" alt="$n$" src="form_22.png"/> functions, <img class="formulaInl" alt="$f_{i}(x),\; i=0, \ldots, n-1$" src="form_23.png"/> we can diagonalize the operator <img class="formulaInl" alt="$\hat{H}$" src="form_24.png"/> in the subspace by constructing the matrix representations of the operator ( <img class="formulaInl" alt="$\mathbf{H}$" src="form_25.png"/>) and metric ( <img class="formulaInl" alt="$\mathbf{S}$" src="form_26.png"/>): </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \mathbf{H}_{ij} &amp; = &amp; \left&lt; f_i \left| \hat{H} \right| f_j \right&gt; \\ \mathbf{S}_{ij} &amp; = &amp; \left&lt; f_i \left| \right. f_j \right&gt;, \end{eqnarray*}" src="form_27.png"/>
</p>
<p> and then solving the generalized eigenvalue problem </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mathbf{HC}=\mathbf{SC}E \]" src="form_28.png"/>
</p>
<p> to obtain the eigenvalues and coefficients in the subspace. The eigenfunctions <img class="formulaInl" alt="$u_{i}(x)$" src="form_29.png"/> are obtained by transforming the original basis </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mathbf{u}=\mathbf{fC} \qquad \mathrm{or} \qquad u_{i}(x) = \sum _{j} f_{j}(x) \mathbf{c}_{ji} \]" src="form_30.png"/>
</p>
<p class="">Given an STL <code>vector</code> of 3<a class="el" href="structD.html">D</a> functions, <code>f</code>, and another <code>Hf</code> containing the result of applying the operator <img class="formulaInl" alt="$\hat{H}$" src="form_24.png"/> to the vector, the above is compactly translated into MADNESS as </p><div class="fragment"><div class="line"><a class="code" href="namespacemadness.html#aec60a184c8b61af2fa44bb7e6ffa5aac">real_tensor</a> H = <a class="code" href="namespacemadness.html#af1d68125d395edddf0111aafa56f1aff">matrix_inner</a>(<a class="code" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, Hf); </div><div class="line"><a class="code" href="namespacemadness.html#aec60a184c8b61af2fa44bb7e6ffa5aac">real_tensor</a> S = <a class="code" href="namespacemadness.html#af1d68125d395edddf0111aafa56f1aff">matrix_inner</a>(<a class="code" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <a class="code" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>); </div><div class="line"><a class="code" href="namespacemadness.html#aec60a184c8b61af2fa44bb7e6ffa5aac">real_tensor</a> <a class="code" href="mtxm__gen_8h.html#aaeb113699ebccfb29980ae43d2e19bdd">C</a>, E; </div><div class="line"></div><div class="line"><a class="code" href="namespacemadness.html#a27afd954228a021066ae01a3ac38f7d2">sygv</a>(H, S, 1, <a class="code" href="classC.html">C</a>, E); </div><div class="line"><a class="code" href="namespacemadness.html#a6df33082686a2b95565459297f49fd86">vector_real_function_3d</a> evec = <a class="code" href="namespacemadness.html#aec23075bfdac45b4af20be4ce099a277">transform</a>(<a class="code" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <a class="code" href="classC.html">C</a>); </div></div><!-- fragment --><p class="">The <code><a class="el" href="namespacemadness.html#af1d68125d395edddf0111aafa56f1aff">matrix_inner()</a></code> routine computes the matrix of inner products (or matrix elements) of two vectors of functions, and the <code><a class="el" href="namespacemadness.html#a27afd954228a021066ae01a3ac38f7d2" title="Generalized real-symmetric or complex-Hermitian eigenproblem. ">sygv()</a></code> routine (in <code>linalg/tensor_lapack.h</code>) is a wrapper around the LAPACK real symmetric and complex Hermitian generalized eigenvalue routines. Finally, the <code><a class="el" href="namespacemadness.html#aec23075bfdac45b4af20be4ce099a277" title="Transforms a vector of functions according to new[i] = sum[j] old[j]*c[j,i]. ">transform()</a></code> routine transforms the basis to compute the eigenfunctions.</p>
<p class="">Previous: <a class="el" href="group__gstart__comp__run.html">Compiling and running MADNESS programs</a>; Next: <a class="el" href="group__gstart__io.html">Input/Output</a> </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Feb 6 2020 16:37:43 for MADNESS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
