<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: Futures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MADNESS
   &#160;<span id="projectnumber">0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">Futures<div class="ingroups"><a class="el" href="group__libraries.html">MADNESS libraries</a> &raquo; <a class="el" href="group__parallel__runtime.html">Parallel programming environment</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Futures:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__futures.png" border="0" alt="" usemap="#group____futures"/>
<map name="group____futures" id="group____futures">
<area shape="rect" id="node1" href="group__taskq.html" title="Task queue" alt="" coords="404,298,492,323"/>
<area shape="rect" id="node2" href="group__hashing.html" title="Hashing" alt="" coords="414,397,482,422"/>
<area shape="rect" id="node3" href="group__world__object.html" title="Globally addressable\l objects (WorldObject)" alt="" coords="374,233,522,273"/>
<area shape="rect" id="node5" href="group__function.html" title="Function" alt="" coords="412,6,484,31"/>
<area shape="rect" id="node8" href="group__tensor.html" title="Tensor" alt="" coords="417,55,479,81"/>
<area shape="rect" id="node11" href="group__atomics.html" title="Atomic operations" alt="" coords="385,105,511,130"/>
<area shape="rect" id="node9" href="group__world.html" title="Distributed computing\l environment (World and\l its relations)" alt="" coords="369,154,527,209"/>
<area shape="rect" id="node10" href="group__worlddc.html" title="Worlddc" alt="" coords="413,347,483,373"/>
<area shape="rect" id="node6" href="group__mpi.html" title="Interfaces from World\l to MPI" alt="" coords="376,447,520,487"/>
<area shape="rect" id="node12" href="group__mutexes.html" title="Mutexes" alt="" coords="413,511,483,537"/>
<area shape="rect" id="node7" href="group__parallel__runtime.html" title="Parallel programming\l environment" alt="" coords="6,263,149,303"/>
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:future_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="future_8h.html">future.h</a></td></tr>
<tr class="memdesc:future_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements <code>Future</code> and related items. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacemadness"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemadness.html">madness</a></td></tr>
<tr class="memdesc:namespacemadness"><td class="mdescLeft">&#160;</td><td class="mdescRight">File holds all helper structures necessary for the CC_Operator and <a class="el" href="classmadness_1_1CC2.html">CC2</a> class. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000020">Todo:</a></b></dt><dd>Badly in need of a general description. There's a lot of jargon in the implementation's documentation &ndash; a future is <em>assigned</em>, etc. &ndash; that should be clarified. Just sayin'. There's some text in a comment (not doxygen) near the beginning of the <code>Future</code> class. Maybe move it here? Hell, I went ahead an copied (cut, really) it here, right here, just for you. </dd></dl>
<div class="fragment"><div class="line"><span class="comment">// This future object can exist in one of three states:</span></div><div class="line"><span class="comment">//   - f == NULL &amp;&amp; value == NULL : Default initialized state</span></div><div class="line"><span class="comment">//        This state occurs when the future is constructed via</span></div><div class="line"><span class="comment">//        Future::default_initializer().</span></div><div class="line"><span class="comment">//   - f != NULL &amp;&amp; value == NULL : FutureImpl object will hold the T object</span></div><div class="line"><span class="comment">//        This state occurs when a future is constructed without a value,</span></div><div class="line"><span class="comment">//        or from a remote reference.</span></div><div class="line"><span class="comment">//   - f == NULL $$ value != NULL : T object is held in buffer</span></div><div class="line"><span class="comment">//        This state occurs when a future is constructed with a value</span></div><div class="line"><span class="comment">//        or from an input archive.</span></div></div><!-- fragment --><dl class="section user"><dt>Gotchas</dt><dd></dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000021">Todo:</a></b></dt><dd>This is taken from some crude remarks that used to be in worldfut.h (now future.h). It needs to be edited/verified before this goes live. It could probably use a better section heading than "Gotchas", too...</dd></dl>
<p class=""><a class="el" href="classA.html">A</a> common misconception is that STL containers initialize their contents by invoking the default constructor of each item in the container (since we are told that the items must be default constructable). But this is <em>incorrect</em>. The items are initialized by invoking the copy constructor for each element on a <em>single</em> object made with the default constructor. For futures this is a very bad problem. For instance, </p><div class="fragment"><div class="line">vector&lt; Future&lt;double&gt; &gt; v(3);</div></div><!-- fragment --><p> is equivalent to the following with an array of three elements </p><div class="fragment"><div class="line">Future&lt;double&gt; junk;</div><div class="line">Future&lt;double&gt; v[3] = {junk,junk,junk};</div></div><!-- fragment --><p> Since the Future copy constructor is by necessity shallow, each element of <code>v</code> ends up referring to the future implementation that underlies <code>junk</code>. When you assign to an element of <code>v</code>, you'll also be assigning to junk. But since futures are single assignment variables, you can only do that once. Hence, when you assign a second element of <code>v</code> you'll get a runtime exception.</p>
<p class="">The fix (other than using arrays) is to initialize STL vectors and other containers from the special element returned by <code>Future&lt;T&gt;::default_initializer()</code>, which if passed into the copy constructor will cause it to behave just like the default contructor. Thus, the following code is what you actually need to use an STL vector of futures </p><div class="fragment"><div class="line">vector&lt; Future&lt;double&gt; &gt; v(3, Future&lt;double&gt;::default_initializer());</div></div><!-- fragment --><p> which is laborious. Instead, we provide the factory function </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line">vector&lt; Future&lt;T&gt; &gt; <a class="code" href="namespacemadness.html#a4519f178c8c87679e130be78ba3948d6">future_vector_factory</a>(std::size_t n);</div></div><!-- fragment --><p> which enables you to write </p><div class="fragment"><div class="line">vector&lt; Future&lt;double&gt; &gt; v = future_vector_factory&lt;double&gt;(3);</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Feb 6 2020 16:37:43 for MADNESS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
