<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: Input/Output</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MADNESS<span id="projectnumber">&#160;0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">Input/Output<div class="ingroups"><a class="el" href="group__getting__started.html">Getting started with MADNESS</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Input/Output:</div>
<div class="dyncontent">
<div class="center"><img src="group__gstart__io.png" border="0" usemap="#agroup____gstart____io" alt=""/></div>
<map name="agroup____gstart____io" id="agroup____gstart____io">
<area shape="rect" href="group__getting__started.html" title=" " alt="" coords="5,5,157,45"/>
<area shape="rect" title=" " alt="" coords="205,13,308,38"/>
</map>
</div>
<dl class="section user"><dt>Moving functions to/from disk</dt><dd>It takes at most a couple of lines of code to move a function to/from disk. The example program <code>trunk/src/examples/functionio.cc</code> shows how to do this, and the critical lines are <div class="fragment"><div class="line">ParallelOutputArchive out(world, filename); </div>
<div class="line">out &amp; <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a> &amp; <a class="code hl_function" href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a> &amp; <a class="code hl_function" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a>; </div>
<div class="line">ParallelInputArchive in(world, filename); </div>
<div class="line">in &amp; <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a> &amp; <a class="code hl_function" href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a> &amp; <a class="code hl_function" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a>; </div>
<div class="ttc" id="aderivatives_8cc_html_a077a479820cb59b18ba5f9565d735e0f"><div class="ttname"><a href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a></div><div class="ttdeci">double(* f)(const coord_3d &amp;)</div><div class="ttdef"><b>Definition</b> derivatives.cc:54</div></div>
<div class="ttc" id="atestgconv_8cc_html_a1b316ea96c1d33492502ec00c5e4e75f"><div class="ttname"><a href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a></div><div class="ttdeci">double g(const coord_t &amp;r)</div><div class="ttdef"><b>Definition</b> testgconv.cc:116</div></div>
<div class="ttc" id="atestgconv_8cc_html_a53028368f0d63292287ec601c3b24ee0"><div class="ttname"><a href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a></div><div class="ttdeci">double h(const coord_1d &amp;r)</div><div class="ttdef"><b>Definition</b> testgconv.cc:175</div></div>
</div><!-- fragment --> Here, <code>f</code>, <code>g</code>, and <code>h</code> are MADNESS functions of any type (they need not have the same type or dimension).</dd></dl>
<p>MADNESS has a generic mechanism for (de)serializing objects from directional streams, called archives, that avoids confusion with the STL stream concept. Anything can be written to and read from an archive, though user-defined types usually need a little additional code to enable this (see <code>trunk/src/madness/world/archive.h</code> for documentation). Most archives are sequential objects accessible only to a single process and it makes little sense to write a potentially large function that is distributed across the entire parallel computer to such an archive. For that reason, functions must be written to/from a parallel archive that performs efficient parallel I/O.</p>
<p>Large amounts of data (more than a few gigabytes) will benefit from increasing the number of processors actually doing disk I/O (refer to the relevant parallel archive class for more info).</p>
<dl class="section user"><dt>Plotting</dt><dd></dd></dl>
<p>MADNESS can presently generate uniform grids in formats suitable for several visualization software packages. The following are explicitly supported:</p><ul>
<li>OpenDX (in a <code>*.dx</code> file)</li>
<li>Paraview (in a VTK file)</li>
<li>line plots in a text format suitable for nearly any tool (e.g., \ gnuplot or xmgrace).</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The program <code>mraplot</code> can be used to generate plots from functions stored on disk.</dd></dl>
<p><em>OpenDX</em></p>
<p>OpenDX is an open source visualization software based on IBM's Visualization Data Explorer (<a href="http://www.opendx.org/">www.opendx.org</a>). Please refer to the OpenDX manual for its use. An example configuration file (<code>vizit.cfg</code>) and a network file (<code>vizit.net</code>) can be found in the <code>trunk/src/apps/moldft/</code> directory. Here are some details on creating your own DX files.</p>
<p>Given any MADNESS function <code>f</code>, you can write to disk a uniform grid over the entire simulation volume with </p><div class="fragment"><div class="line">plotdx(<a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <span class="stringliteral">&quot;f.dx&quot;</span>);</div>
</div><!-- fragment --><p>Additional arguments permit us to change the plot volume (default is the entire simulation volume), the number of points (default is 201) and binary/text format (default is binary). This is a collective operation.</p>
<p>Visualizing this with OpenDX is straightforward, but depends on the number of dimensions. The easiest way is to start OpenDX, click "Import Data ...", enter your filename, and click "Visualize Data". However, you will want to learn how to build your own networks. To display an iso-surface of 3<a class="el" href="structD.html">D</a> data, start the visual editor and connect </p><pre class="fragment">file-selector --&gt; import --&gt; isosurface --&gt; image
</pre><p>Enter your name in the file-selector, and you should see the picture. You can adjust the isosurface value in the isosurface control or by connecting it to an interactor. Have fun!</p>
<p><em>VTK format and Paraview</em></p>
<p>MADNESS can export MADNESS functions to the serial vtkStructuredGrid (.vts) file format, which can be ready by several post-processing visualization packages such as Paraview. To write this data file, you must first define four quantities:</p><ol type="1">
<li>a filename (<code>filename</code>),</li>
<li>the lower (<code>plotlo</code>) bound of Cartesian coordinates in each dimension to plot,</li>
<li>the corresponding upper (<code>plothi</code>) bound,</li>
<li>the number of points (<code>npts</code>) in each dimension to evaluate.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>At this time, MADNESS evaluates the functions at equally spaced points between <code>plotlo</code> and <code>plothi</code>.</dd></dl>
<p>After the above four quantities have been defined, three functions must be called:</p><ul>
<li><code>plotvtk_begin</code>: Writes the VTK boilerplate header information.</li>
<li><code>plotvtk_data</code>: Evaluates and writes the MADNESS function at <code>npts</code>.</li>
<li><code>plotvtk_end</code>: Writes the VTK boilerplate footer information.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Currently, the function evaluation in <code>plotvtk_data</code> is done in serial.</dd></dl>
<p>An example of code for plotting two two-dimensional functions <code>u</code> and <code>v</code> in a <picture><source srcset="form_86_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$[0,1]^{2}$" src="form_86.png"/></picture> box with 101 points is as follows: </p><div class="fragment"><div class="line"><span class="keywordtype">char</span> filename[100]; </div>
<div class="line">sprintf(filename, output.vts); <span class="comment">// Defines the filename </span></div>
<div class="line">Vector&lt;double, 2&gt; plotlo, plothi; <span class="comment">// Box dimensions </span></div>
<div class="line">Vector&lt;long, 2&gt; <a class="code hl_variable" href="testgconv_8cc.html#ad152e33038796ca373c22253bcd5f9a4">npts</a>; <span class="comment">// Num points in each dim</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) </div>
<div class="line">{ </div>
<div class="line">  plotlo[i] = 0.0; </div>
<div class="line">  plothi[i] = 1.0; </div>
<div class="line">  <a class="code hl_variable" href="testgconv_8cc.html#ad152e33038796ca373c22253bcd5f9a4">npts</a>[i] = 101; </div>
<div class="line">} </div>
<div class="line"> </div>
<div class="line">plotvtk_begin(world, filename, plotlo, plothi, <a class="code hl_variable" href="testgconv_8cc.html#ad152e33038796ca373c22253bcd5f9a4">npts</a>); </div>
<div class="line">plotvtk_data(<a class="code hl_function" href="he_8cc.html#ad78e81e39fd9905a571cb98c174c3a09">u</a>, <a class="code hl_function" href="he_8cc.html#ad78e81e39fd9905a571cb98c174c3a09">u</a>, world, filename, plotlo, plothi, <a class="code hl_variable" href="testgconv_8cc.html#ad152e33038796ca373c22253bcd5f9a4">npts</a>); </div>
<div class="line">plotvtk_data(<a class="code hl_variable" href="hatom__sf__dirac_8cc.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>, <a class="code hl_variable" href="hatom__sf__dirac_8cc.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>, world, filename, plotlo, plothi, <a class="code hl_variable" href="testgconv_8cc.html#ad152e33038796ca373c22253bcd5f9a4">npts</a>); </div>
<div class="line">plotvtk_end&lt;3&gt;(world, filename); </div>
<div class="ttc" id="ahatom__sf__dirac_8cc_html_af16c6805bd7f1a6a9acfe503216a5555"><div class="ttname"><a href="hatom__sf__dirac_8cc.html#af16c6805bd7f1a6a9acfe503216a5555">v</a></div><div class="ttdeci">static const double v</div><div class="ttdef"><b>Definition</b> hatom_sf_dirac.cc:20</div></div>
<div class="ttc" id="ahe_8cc_html_ad78e81e39fd9905a571cb98c174c3a09"><div class="ttname"><a href="he_8cc.html#ad78e81e39fd9905a571cb98c174c3a09">u</a></div><div class="ttdeci">static double u(double r, double c)</div><div class="ttdef"><b>Definition</b> he.cc:20</div></div>
<div class="ttc" id="atestgconv_8cc_html_ad152e33038796ca373c22253bcd5f9a4"><div class="ttname"><a href="testgconv_8cc.html#ad152e33038796ca373c22253bcd5f9a4">npts</a></div><div class="ttdeci">const auto npts</div><div class="ttdef"><b>Definition</b> testgconv.cc:52</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>An arbitrary number of MADNESS files may be written to a single file. Two are shown above for demonstrative purposes; however, <code>plotvtk_data</code> may be called multiple times between <code>plotvtk_begin</code> and <code>plotvtk_end</code> function calls.</li>
<li>For time-dependent simulations, the above code can be included within the time step loop. The user should then consider appending the filename with the timestep number and create <code>Ntimestep</code> files, each containing one increment of time.</li>
</ul>
</dd></dl>
<p>To visualize your functions, Paraview has been extensively tested, although other external visualization packages may also be compatible with the <code>vts</code> file format. Paraview is an open-source visualization application that is freely downloadable. For information about how to download, install and use Paraview, please consult their webpage at <a href="http://www.paraview.org">http://www.paraview.org</a>.</p>
<p><em>Line plots</em></p>
<p>With a single function call, up to three functions can be simultaneously evaluated at points along a line with the values printed to a file suitable for use by any standard 2<a class="el" href="structD.html">D</a> graphics or spreadsheet software. For example, to plot one 4<a class="el" href="structD.html">D</a> function (<code>f</code>) along a line between <picture><source srcset="form_87_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$(0,0,0,1)$" src="form_87.png"/></picture> and <picture><source srcset="form_88_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$(0,1,0,2)$" src="form_88.png"/></picture> with 101 points </p><div class="fragment"><div class="line">coord_3d <a class="code hl_variable" href="dirac-hatom_8cc.html#a38679ec7be54767d8559b4bdac308746">lo</a>, hi; </div>
<div class="line"><a class="code hl_variable" href="dirac-hatom_8cc.html#a38679ec7be54767d8559b4bdac308746">lo</a>[3]=1.0; hi[1]=1.0; hi[2]=2.0; </div>
<div class="line">plot_line(<span class="stringliteral">&quot;plot.txt&quot;</span>, 101, <a class="code hl_variable" href="dirac-hatom_8cc.html#a38679ec7be54767d8559b4bdac308746">lo</a>, hi, <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>);</div>
<div class="ttc" id="adirac-hatom_8cc_html_a38679ec7be54767d8559b4bdac308746"><div class="ttname"><a href="dirac-hatom_8cc.html#a38679ec7be54767d8559b4bdac308746">lo</a></div><div class="ttdeci">static double lo</div><div class="ttdef"><b>Definition</b> dirac-hatom.cc:23</div></div>
</div><!-- fragment --><p>To plot two functions (<code>f</code> and <code>g</code>) you would use instead </p><div class="fragment"><div class="line">plot_line(<span class="stringliteral">&quot;plot.txt&quot;</span>, 101, <a class="code hl_variable" href="dirac-hatom_8cc.html#a38679ec7be54767d8559b4bdac308746">lo</a>, hi, <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <a class="code hl_function" href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a>);</div>
</div><!-- fragment --><p>With gnuplot, you can plot the data as follows </p><pre class="fragment">gnuplot -persist -e 'set style data lines; plot "plot.txt"'
</pre><p>Previous: <a class="el" href="group__gstart__functions.html">MADNESS functions</a>; Next: <a class="el" href="group__gstart__load__balance.html">Load and memory balancing</a> </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 28 2025 18:18:37 for MADNESS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
