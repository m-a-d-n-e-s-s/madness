<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: Solves the 3D harmonic oscillator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MADNESS<span id="projectnumber">&#160;0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">Solves the 3D harmonic oscillator</div></div>
</div><!--header-->
<div class="contents">
<p>The source is <a href="https://github.com/m-a-d-n-e-s-s/madness/blob/master/src/examples/3dharmonic.cc">here</a>.</p>
<dl class="section user"><dt>Points of interest</dt><dd><ul>
<li>convolution with the Green's function</li>
<li>need to adjust the zero of energy to use the bound-state Green's function</li>
<li>failure of simple fixed-point iteration</li>
<li>use of simple non-linear equation solver</li>
<li>plotting 3<a class="el" href="structD.html">D</a> function along a line</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Background</dt><dd></dd></dl>
<p>We seek the ground state of the 3<a class="el" href="structD.html">D</a> Schrodinger equation  </p><p class="formulaDsp">
<picture><source srcset="form_92_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\left( -\frac{1}{2} \nabla^2 + V(r) \right) \psi(r) = E \psi(r)
\]" src="form_92.png"/></picture>
</p>
<p> with  </p><p class="formulaDsp">
<picture><source srcset="form_93_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
V(r) = \frac{1}{2} |r|^2
\]" src="form_93.png"/></picture>
</p>
<p> As usual, we rewrite the differential equation into integral form  </p><p class="formulaDsp">
<picture><source srcset="form_94_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\psi(r) = \left( -\frac{1}{2} \nabla^2 - E \right)^{-1} V(r) \psi(r)
\]" src="form_94.png"/></picture>
</p>
<p> but unfortunately we are left with two problems.</p>
<p>First, recall that application of the inverse of the differential operator corresponds to convolution with the Green's function to the Helmholtz equation that satisfies  </p><p class="formulaDsp">
<picture><source srcset="form_95_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\left(-\nabla^2 + \mu^2 \right) G(r,r'; \mu) = \delta(r-r')
\]" src="form_95.png"/></picture>
</p>
<p> In 3<a class="el" href="structD.html">D</a>, we have  </p><p class="formulaDsp">
<picture><source srcset="form_96_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
G(r,r'; \mu) = \frac{e^{-\mu |r-r'|}}{4 \pi |r-r|}
\]" src="form_96.png"/></picture>
</p>
<p> that MADNESS can currently only apply efficiently for real <picture><source srcset="form_97_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\mu$" src="form_97.png"/></picture> and since <picture><source srcset="form_98_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\mu = \sqrt{-2 E}$" src="form_98.png"/></picture> only for negative energies (hence bound states). But for the harmonic oscillator there are no free particle states and the zero of energy is not chosen to describe the lowest energy of a free particle but simply as the zero of potential energy. To solve this problem we can shift the zero of energy down by subtracting a constant ( <picture><source srcset="form_99_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\Delta$" src="form_99.png"/></picture>) from both sides of the equation, hence making the effective ground state energy negative.  </p><p class="formulaDsp">
<picture><source srcset="form_100_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\psi(r) = \left( -\frac{1}{2} \nabla^2 - E + \Delta \right)^{-1} \left( V(r) -\Delta\right)  \psi(r)
\]" src="form_100.png"/></picture>
</p>
<p>How negative do we need to make the energy? To answer this we need to discuss the second problem. The fixed-point iteration described by the integral equation only reliably converges to the ground state if the potential is negative everywhere the wave function is significant. The exact solution is <picture><source srcset="form_101_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\psi(r)=\pi^{-1/4}\exp(-r^2 / 2)$" src="form_101.png"/></picture> (with $E=$1.5) that becomes 1e-6 (but how small is small enough?) at <picture><source srcset="form_102_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$r=5.3$" src="form_102.png"/></picture> where <picture><source srcset="form_14_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$V$" src="form_14.png"/></picture> is 14.0. So let's take this as the value of <picture><source srcset="form_99_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\Delta$" src="form_99.png"/></picture> and try the fixed point iteration. Bad news. It starts converging (slowly) to the right answer but then diverges and even damping (step restriction) does not solve the problem. We have to make the shift large enough to make the potential negative in the entire volume to avoid the divergence, but this makes the convergence really slow.</p>
<p>The fix is to not rely upon the simple fixed point iteration but to use an equation solver to force convergence. This also enables us to choose the size of the shift to optimize the rate of convergence (empirically <picture><source srcset="form_103_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\Delta=7$" src="form_103.png"/></picture> is best) rather than being forced to pick a large value. We use the very easy to use solver in <a class="el" href="nonlinsol_8h.html" title="Implementation of Krylov-subspace nonlinear equation solver.">mra/nonlinsol.h</a> .</p>
<p>[Aside. It is possible to apply the operator for positive energies, but efficient application requires separate treatment of the singular and the long-range oscillatory terms, and the latter is presently not a production capability of MADNESS. If you need this, let us know.] </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 28 2026 13:36:10 for MADNESS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
