<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: MADNESS functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MADNESS<span id="projectnumber">&#160;0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">MADNESS functions<div class="ingroups"><a class="el" href="group__getting__started.html">Getting started with MADNESS</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for MADNESS functions:</div>
<div class="dyncontent">
<div class="center"><img src="group__gstart__functions.png" border="0" usemap="#agroup____gstart____functions" alt=""/></div>
<map name="agroup____gstart____functions" id="agroup____gstart____functions">
<area shape="rect" href="group__getting__started.html" title=" " alt="" coords="5,5,157,45"/>
<area shape="rect" title=" " alt="" coords="205,13,356,38"/>
</map>
</div>
<dl class="section user"><dt>Defaults for functions</dt><dd></dd></dl>
<p>Default values for all function and operator attributes are stored in the <code>FunctionDefaults</code> class. This is actually a template so that different values can be set for functions with different numbers of dimensions. We saw earlier that </p><div class="fragment"><div class="line">FunctionDefaults&lt;1&gt;::set_cubic_cell(0,10);</div>
</div><!-- fragment --><p> sets the user's simulation cell as <picture><source srcset="form_0_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$[0,10]$" src="form_0.png"/></picture>. Presently, all functions of a given dimension must share the same cell. Other common attributes are</p><ul>
<li><code>k</code> &ndash; the wavelet order. <a class="el" href="classA.html">A</a> practical rule of thumb is if the default truncation threshold is <picture><source srcset="form_1_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$10^{-n}$" src="form_1.png"/></picture>, then the order should be chosen as <picture><source srcset="form_2_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$k=n+2$" src="form_2.png"/></picture>. The default is 6.</li>
<li><code>thresh</code> &ndash; the truncation threshold. The default is <code>1e-4</code>.</li>
<li><code>bc</code> &ndash; the boundary conditions. See below for more details. The default is free.</li>
</ul>
<dl class="section user"><dt>Boundary conditions</dt><dd></dd></dl>
<p>In MADNESS, boundary conditions are associated with operators, not functions, and the boundary conditions are imposed on the surface enclosing the entire simulation volume. That is, they are exterior boundary conditions. For derivative operators the following conditions are understood, and can be imposed separately on each surface</p><ul>
<li><code>BC_ZERO</code> &ndash; Zero Dirichlet</li>
<li><code>BC_PERIODIC</code> &ndash; Periodic (both left and right surfaces must agree on this value)</li>
<li><code>BC_FREE</code> &ndash; Free (default)</li>
<li><code>BC_DIRICHLET</code> &ndash; General Dirichlet (requires provision of one or more functions)</li>
<li><code>BC_ZERONEUMANN</code> &ndash; Zero Neumann</li>
<li><code>BC_NEUMANN</code> &ndash; General Neumann (requires provision of one or more functions)</li>
</ul>
<p>For integral operators only periodic and free-space conditions are understood &ndash; <code>BC_PERIODIC</code> yields periodic and all other conditions yield free-space.</p>
<p>Example: to make the default boundary conditions in 3<a class="el" href="structD.html">D</a> </p><div class="fragment"><div class="line">BoundaryConditions&lt;3&gt; bc(BC_FREE);</div>
</div><!-- fragment --><p>Example: to make boundary conditions in 3<a class="el" href="structD.html">D</a> with zero Dirichlet in <picture><source srcset="form_3_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$x$" src="form_3.png"/></picture> and <picture><source srcset="form_4_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$y$" src="form_4.png"/></picture> and periodic in <picture><source srcset="form_5_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$z$" src="form_5.png"/></picture>, </p><div class="fragment"><div class="line">BoundaryConditions&lt;3&gt; bc(BC_ZERO);</div>
<div class="line"> </div>
<div class="line">bc(2,0) = bc(2,1) = BC_PERIODIC;</div>
</div><!-- fragment --><p>Example: to override the default boundary conditions with yours in a variable named <code>bc</code> in 3<a class="el" href="structD.html">D</a> </p><div class="fragment"><div class="line">FunctionDefaults&lt;3&gt;::set_bc(bc);</div>
</div><!-- fragment --><dl class="section user"><dt>Differentiation, multiplication, inner products</dt><dd></dd></dl>
<p>We now examine operations such as differentiation, multiplication, and inner products. <a class="el" href="classA.html">A</a> relevant simple example is <code>trunk/src/examples/hatom_energy.cc</code>.</p>
<p><em>Differentiation</em></p>
<p>Differentiation is performed by applying a differential operator to a function. The operator is constructed with desired the boundary conditions and direction for differentiation (directions are indexed starting from zero, so in 3<a class="el" href="structD.html">D</a> <code>x=0</code>, <code>y=1</code>, and <code>z=2</code>). The operators can be kept for repeated application, or made and discarded after use.</p>
<p>For example, to make the derivative operator in 3<a class="el" href="structD.html">D</a> with respect to the first variable using boundary conditions from <code>FunctionDefaults</code>, and to apply it to functions <code>f</code>, <code>g</code> and <code>h</code>: </p><div class="fragment"><div class="line">real_derivative_3d Dx(world, 0); </div>
<div class="line">real_function_3d dfdx = Dx(<a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>); </div>
<div class="line">real_function_3d dgdx = Dx(<a class="code hl_function" href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a>); </div>
<div class="line">real_function_3d dhdx = Dx(<a class="code hl_function" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a>); </div>
<div class="ttc" id="aderivatives_8cc_html_a077a479820cb59b18ba5f9565d735e0f"><div class="ttname"><a href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a></div><div class="ttdeci">double(* f)(const coord_3d &amp;)</div><div class="ttdef"><b>Definition</b> derivatives.cc:54</div></div>
<div class="ttc" id="atestgconv_8cc_html_a1b316ea96c1d33492502ec00c5e4e75f"><div class="ttname"><a href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a></div><div class="ttdeci">double g(const coord_t &amp;r)</div><div class="ttdef"><b>Definition</b> testgconv.cc:116</div></div>
<div class="ttc" id="atestgconv_8cc_html_a53028368f0d63292287ec601c3b24ee0"><div class="ttname"><a href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a></div><div class="ttdeci">double h(const coord_1d &amp;r)</div><div class="ttdef"><b>Definition</b> testgconv.cc:175</div></div>
</div><!-- fragment --><p><em>Multiplication, addition, subtraction of functions</em></p>
<p>Most simple mathematical operations can be composed in MADNESS as they are normally written in standard notation. For instance, if <code>f</code>, <code>g</code> and <code>h</code> are functions the expression  </p><p class="formulaDsp">
<picture><source srcset="form_6_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
f(x) = 2g(x) + 3h(x) - 7g(x)h(x) + 99
\]" src="form_6.png"/></picture>
</p>
<p> is transcribed as </p><div class="fragment"><div class="line"><a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a> = 2*<a class="code hl_function" href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a> + 3*<a class="code hl_function" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a> - 7*<a class="code hl_function" href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a>*<a class="code hl_function" href="testgconv_8cc.html#a53028368f0d63292287ec601c3b24ee0">h</a> + 99;</div>
</div><!-- fragment --><p> where <code>*</code> indicates point-wise multiplication of functions.</p>
<dl class="section attention"><dt>Attention</dt><dd>Addition and subtraction of functions are exact operations in the sense that the result can be exactly represented in the MADNESS basis. Multiplication is <em>inexact</em> since the product of two polynomials of order <picture><source srcset="form_7_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$k$" src="form_7.png"/></picture> is of order <picture><source srcset="form_8_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$2k$" src="form_8.png"/></picture>. The auto-refinement algorithm within MADNESS is still under development &ndash; please refer to the implementation notes for more detail.</dd></dl>
<p><em>Inner products</em></p>
<p>The inner product of two functions is defined as  </p><p class="formulaDsp">
<picture><source srcset="form_9_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\left( f \left| g \right. \right) = \int f(x)^\textrm{*} g(x) dx,
\]" src="form_9.png"/></picture>
</p>
<p> where <picture><source srcset="form_10_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\textrm{*}$" src="form_10.png"/></picture> indicates complex conjugation and the integral is taken over the entire simulation volume. The above is computed for two MADNESS functions <code>f</code> and <code>g</code> of the same type using </p><div class="fragment"><div class="line"><a class="code hl_function" href="fcwf_8cc.html#ac9c1d98ab6415b5d03f9ffc503a497f1">inner</a>(<a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <a class="code hl_function" href="testgconv_8cc.html#a1b316ea96c1d33492502ec00c5e4e75f">g</a>);</div>
<div class="ttc" id="afcwf_8cc_html_ac9c1d98ab6415b5d03f9ffc503a497f1"><div class="ttname"><a href="fcwf_8cc.html#ac9c1d98ab6415b5d03f9ffc503a497f1">inner</a></div><div class="ttdeci">std::complex&lt; double &gt; inner(const Fcwf &amp;psi, const Fcwf &amp;phi)</div><div class="ttdef"><b>Definition</b> fcwf.cc:275</div></div>
</div><!-- fragment --><p> If the input functions are real, the result is real; for complex functions the result is complex.</p>
<dl class="section user"><dt>Integral operators</dt><dd></dd></dl>
<p>The Poisson equation  </p><p class="formulaDsp">
<picture><source srcset="form_11_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\nabla^{2} u = -4\pi \rho 
\]" src="form_11.png"/></picture>
</p>
<p> is ubiquitous in scientific and engineering simulations. For the sake of simplicity, we assume free-space boundary conditions (zero at infinity), such that the Green's function is just <picture><source srcset="form_12_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$1/\left| r \right|$" src="form_12.png"/></picture>. If the right-hand side of the Poisson equation is <code>rho</code>, then the Poisson equation can be solved in MADNESS as </p><div class="fragment"><div class="line">real_convolution_3d <a class="code hl_function" href="kain_8cc.html#a7289a0da1c9f97b9e05dda7fcb41f7bc">op</a> = CoulombOperator(world, 0.001, 1<a class="code hl_function" href="test__sig_8cc.html#aed138f72d7301a9034a719a95c4903da">e</a>-6);</div>
<div class="line"> </div>
<div class="line">real_function_3d result = <a class="code hl_function" href="kain_8cc.html#a7289a0da1c9f97b9e05dda7fcb41f7bc">op</a>(rho);</div>
<div class="ttc" id="akain_8cc_html_a7289a0da1c9f97b9e05dda7fcb41f7bc"><div class="ttname"><a href="kain_8cc.html#a7289a0da1c9f97b9e05dda7fcb41f7bc">op</a></div><div class="ttdeci">Tensor&lt; double &gt; op(const Tensor&lt; double &gt; &amp;x)</div><div class="ttdef"><b>Definition</b> kain.cc:508</div></div>
<div class="ttc" id="atest__sig_8cc_html_aed138f72d7301a9034a719a95c4903da"><div class="ttname"><a href="test__sig_8cc.html#aed138f72d7301a9034a719a95c4903da">e</a></div><div class="ttdeci">void e()</div><div class="ttdef"><b>Definition</b> test_sig.cc:75</div></div>
</div><!-- fragment --><p>This is employed by many codes in the <code>examples</code> directory. The call to <code>CoulombOperator</code> builds a low-separation rank approximation (see the implementation notes) of the Green's function for the Poisson equation. The approximation is accurate to <code>1e-6</code> from a smallest length scale of 0.001 to the entire box size.</p>
<p>If you have more complicated boundary conditions which require single or double layer terms please refer the example in <code>trunk/src/examples/interior_dirichlet.cc</code> for more details.</p>
<dl class="section user"><dt>Operations on vectors of functions</dt><dd></dd></dl>
<p>The header file <code><a class="el" href="vmra_8h.html" title="Defines operations on vectors of Functions.">madness/mra/vmra.h</a></code> defines operations on vectors of functions. These are convenient in eliminating error-prone loops over arrays/vectors of functions, and the vector operations are much more efficient since many operations can occur in parallel. The example code <code>trunk/src/examples/vnucso.cc</code> and the molecular density functional code make extensive use of the vector API (application programming interface) to solve eigenproblems. Let us discuss this in more detail.</p>
<p>Given a subspace defined by a vector of <picture><source srcset="form_13_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$n$" src="form_13.png"/></picture> functions, <picture><source srcset="form_14_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$f_{i}(x),\; i=0, \ldots, n-1$" src="form_14.png"/></picture> we can diagonalize the operator <picture><source srcset="form_15_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\hat{H}$" src="form_15.png"/></picture> in the subspace by constructing the matrix representations of the operator ( <picture><source srcset="form_16_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\mathbf{H}$" src="form_16.png"/></picture>) and metric ( <picture><source srcset="form_17_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\mathbf{S}$" src="form_17.png"/></picture>):  </p><p class="formulaDsp">
<picture><source srcset="form_18_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\begin{eqnarray*}
\mathbf{H}_{ij} &amp; = &amp; \left&lt; f_i \left| \hat{H} \right| f_j \right&gt; \\
\mathbf{S}_{ij} &amp; = &amp; \left&lt; f_i \left|         \right. f_j \right&gt;,
\end{eqnarray*}" src="form_18.png"/></picture>
</p>
<p> and then solving the generalized eigenvalue problem  </p><p class="formulaDsp">
<picture><source srcset="form_19_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\mathbf{HC}=\mathbf{SC}E
\]" src="form_19.png"/></picture>
</p>
<p> to obtain the eigenvalues and coefficients in the subspace. The eigenfunctions <picture><source srcset="form_20_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$u_{i}(x)$" src="form_20.png"/></picture> are obtained by transforming the original basis  </p><p class="formulaDsp">
<picture><source srcset="form_21_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[
\mathbf{u}=\mathbf{fC} \qquad \mathrm{or} \qquad u_{i}(x) = \sum _{j} f_{j}(x) \mathbf{c}_{ji}
\]" src="form_21.png"/></picture>
</p>
<p>Given an STL <code>vector</code> of 3<a class="el" href="structD.html">D</a> functions, <code>f</code>, and another <code>Hf</code> containing the result of applying the operator <picture><source srcset="form_15_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$\hat{H}$" src="form_15.png"/></picture> to the vector, the above is compactly translated into MADNESS as </p><div class="fragment"><div class="line">real_tensor H = <a class="code hl_function" href="fcwf_8cc.html#a17174693600e7b21ae80876af4f6c312">matrix_inner</a>(world, <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, Hf); </div>
<div class="line">real_tensor S = <a class="code hl_function" href="fcwf_8cc.html#a17174693600e7b21ae80876af4f6c312">matrix_inner</a>(world, <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>); </div>
<div class="line">real_tensor <a class="code hl_class" href="classC.html">C</a>, E; </div>
<div class="line"> </div>
<div class="line">sygv(H, S, 1, <a class="code hl_class" href="classC.html">C</a>, E); </div>
<div class="line">vector_real_function_3d evec = <a class="code hl_function" href="fcwf_8cc.html#afc733803f08ee37ea5c9c3665b283b38">transform</a>(world, <a class="code hl_variable" href="derivatives_8cc.html#a077a479820cb59b18ba5f9565d735e0f">f</a>, <a class="code hl_class" href="classC.html">C</a>); </div>
<div class="ttc" id="aclassC_html"><div class="ttname"><a href="classC.html">C</a></div><div class="ttdef"><b>Definition</b> test_ar.cc:170</div></div>
<div class="ttc" id="afcwf_8cc_html_a17174693600e7b21ae80876af4f6c312"><div class="ttname"><a href="fcwf_8cc.html#a17174693600e7b21ae80876af4f6c312">matrix_inner</a></div><div class="ttdeci">Tensor&lt; std::complex&lt; double &gt; &gt; matrix_inner(World &amp;world, std::vector&lt; Fcwf &gt; &amp;a, std::vector&lt; Fcwf &gt; &amp;b)</div><div class="ttdef"><b>Definition</b> fcwf.cc:431</div></div>
<div class="ttc" id="afcwf_8cc_html_afc733803f08ee37ea5c9c3665b283b38"><div class="ttname"><a href="fcwf_8cc.html#afc733803f08ee37ea5c9c3665b283b38">transform</a></div><div class="ttdeci">std::vector&lt; Fcwf &gt; transform(World &amp;world, std::vector&lt; Fcwf &gt; &amp;a, Tensor&lt; std::complex&lt; double &gt; &gt; U)</div><div class="ttdef"><b>Definition</b> fcwf.cc:477</div></div>
</div><!-- fragment --><p>The <code><a class="el" href="fcwf_8cc.html#a17174693600e7b21ae80876af4f6c312">matrix_inner()</a></code> routine computes the matrix of inner products (or matrix elements) of two vectors of functions, and the <code>sygv()</code> routine (in <code>linalg/tensor_lapack.h</code>) is a wrapper around the LAPACK real symmetric and complex Hermitian generalized eigenvalue routines. Finally, the <code><a class="el" href="fcwf_8cc.html#afc733803f08ee37ea5c9c3665b283b38">transform()</a></code> routine transforms the basis to compute the eigenfunctions.</p>
<p>Previous: <a class="el" href="group__gstart__comp__run.html">Compiling and running MADNESS programs</a>; Next: <a class="el" href="group__gstart__io.html">Input/Output</a> </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 28 2025 18:18:37 for MADNESS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
