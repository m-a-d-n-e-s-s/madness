<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: Load and memory balancing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MADNESS<span id="projectnumber">&#160;0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">Load and memory balancing<div class="ingroups"><a class="el" href="group__getting__started.html">Getting started with MADNESS</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Load and memory balancing:</div>
<div class="dyncontent">
<div class="center"><img src="group__gstart__load__balance.png" border="0" usemap="#agroup____gstart____load____balance" alt=""/></div>
<map name="agroup____gstart____load____balance" id="agroup____gstart____load____balance">
<area shape="rect" href="group__getting__started.html" title=" " alt="" coords="5,5,157,45"/>
<area shape="rect" title=" " alt="" coords="205,13,412,38"/>
</map>
</div>
<p>Load and memory balancing is a critical issue on the current generation of shared and distributed memory computers. Many terascale and petascale computers have no virtual memory capabilities on the compute nodes, so memory management is very important.</p>
<p>Poor distribution of work (load imbalance) is the largest reason for inefficient parallel execution within MADNESS. Poor data distribution (data imbalance) contributes to load imbalance and also leads to out-of-memory problems due to one or more processes having too much data. Thus, we are interested in a uniform distribution of both work and data.</p>
<p>Many operations in MADNESS are entirely data driven (i.e., computation occurs in the processor that "owns" the data) since there is insufficient work to justify moving data between processes (e.g., computing the inner product between functions). However, a few expensive operations can have work shipped to other processors.</p>
<p>There are presently three load balancing mechanisms within MADNESS:</p><ul>
<li>static and driven by the distribution of data,</li>
<li>dynamic via random assignment of work, and</li>
<li>dynamic via work stealing (now abandoned).</li>
</ul>
<p>Until the work stealing becomes production quality we must exploit the first two forms. The random work assignment is controlled by options in the <code>FunctionDefaults</code> class:</p><ul>
<li><code>FunctionDefaults::set_apply_randomize(bool)</code> controls the use of randomization in applying integral (convolution) operators. It is typically beneficial when computing to medium/high precision.</li>
<li><code>FunctionDefaults::set_project_randomize(bool)</code> controls the use of randomization in projecting from an analytic form (i.e., C++) into the discontinuous spectral element basis. It is typically beneficial unless there is already a good static data distribution. Since these options are straightforward to enable, this example focuses on static data redistribution.</li>
</ul>
<p>The process map (an instance of <code>WorldDCPmapInterface</code>) controls mapping of data to processors and it is actually quite easy to write your own (e.g., see <code>WorldDCDefaultPmap</code> or <code><a class="el" href="classLevelPmap.html">LevelPmap</a></code>) that ensure uniform data distribution. However, you also seek to incorporate estimates of the computational cost into the distribution. The class <code>LBDeuxPmap</code> (deux since it is the second such class) in <code>trunk/src/madness/mra/lbdeux.h</code> does this by examining the functions you request and using provided weights to estimate the computational cost.</p>
<p>Communication costs are proportional to the number of broken links in the tree. Since some operations work in the scaling function basis, some in the multiwavelet basis, and some in non-standard form, there is an element of empiricism in getting best performance from most algorithms.</p>
<p>The example code in <a href="https://github.com/m-a-d-n-e-s-s/madness/blob/master/src/examples/dataloadbal.cc"><code>src/examples/dataloadbal.cc</code></a> illustrates how the discussions in this section can be applied.</p>
<p>Previous: <a class="el" href="group__gstart__io.html">Input/Output</a>; Next: <a class="el" href="group__gstart__think__madness.html">Thinking in MADNESS</a> </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 28 2026 13:36:10 for MADNESS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
